import t from"util";import e from"amqplib";import{cleanEnv as o,str as n,port as r}from"envalid";function s(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,i(t,e)}function i(t,e){return i=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},i(t,e)}require("dotenv").config();var c,u=/*#__PURE__*/function(){function s(e){var s=this;this.user=void 0,this.password=void 0,this.host=void 0,this.port=void 0,this.vhost=void 0,this.url=void 0,this.channel=void 0,this.canUseEnvConfig(e)?o(process.env,{RABBITMQ_HOST:n(),RABBITMQ_PASSWORD:n(),RABBITMQ_PORT:r({default:5672}),RABBITMQ_USER:n(),RABBITMQ_VHOST:n()}):(this.user=e.user,this.password=e.password,this.host=e.host,this.port=e.port,this.vhost=e.vhost),this.url=t.format("amqp://%s:%s@%s:%s/%s",this.user||process.env.RABBITMQ_USER,this.password||process.env.RABBITMQ_PASSWORD,this.host||process.env.RABBITMQ_HOST,this.port||process.env.RABBITMQ_PORT,this.vhost||process.env.RABBITMQ_VHOST),this.connect(this.url).then(function(t){s.channel=t})}var i=s.prototype;return i.canUseEnvConfig=function(t){return void 0!==t.useEnvironmentConfig},i.connect=function(t){try{return Promise.resolve(e.connect(t)).then(function(t){return Promise.resolve(t.createChannel())})}catch(t){return Promise.reject(t)}},i.send=function(t){try{try{console.log("[Data]",t),this.channel.assertQueue(t.queue,{durable:!0});var e=this.channel.sendToQueue(t.queue,Buffer.from(JSON.stringify(t.data)));console.log("[MQ Status]",e),console.log(" [x] Sent %s",t.data)}catch(t){console.log(t)}return Promise.resolve()}catch(t){return Promise.reject(t)}},i.onReceive=function(t){var e=t.queue;try{var o,n=this;return n.channel&&(null==(o=n.channel)||o.assertQueue(e,{durable:!0}),n.channel.consume(e,function(t){return console.log(t),console.log("[x] receiving messages"),n.channel.ack(t),new Promise(function(e){return e(t)})})),Promise.resolve(null)}catch(t){return Promise.reject(t)}},s}(),a=/*#__PURE__*/function(t){function e(){return t.apply(this,arguments)||this}return s(e,t),e.prototype.sendEmail=function(t){var e=t.queue;this.send({data:t.data,queue:void 0===e?"email_notification":e})},e}(u),h=/*#__PURE__*/function(t){function e(){return t.apply(this,arguments)||this}return s(e,t),e.prototype.createNotification=function(t){var e=t.queue;this.send({data:t.data,queue:void 0===e?"event_notification":e})},e}(u),p=/*#__PURE__*/function(t){function e(){return t.apply(this,arguments)||this}return s(e,t),e}(u);c=p,[a,h].forEach(function(t){Object.getOwnPropertyNames(t.prototype).forEach(function(e){Object.defineProperty(c.prototype,e,Object.getOwnPropertyDescriptor(t.prototype,e))})});export{p as default};
