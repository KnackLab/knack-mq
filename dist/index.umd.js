!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("util"),require("amqplib"),require("envalid")):"function"==typeof define&&define.amd?define(["util","amqplib","envalid"],t):(e||self).knackMq=t(e.util,e.amqplib,e.envalid)}(this,function(e,t,n){function o(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var r=/*#__PURE__*/o(e),i=/*#__PURE__*/o(t);function s(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,u(e,t)}function u(e,t){return u=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},u(e,t)}require("dotenv").config();var c,a=/*#__PURE__*/function(){function e(e){var t=this;this.user=void 0,this.password=void 0,this.host=void 0,this.port=void 0,this.vhost=void 0,this.url=void 0,this.channel=void 0,this.canUseEnvConfig(e)?n.cleanEnv(process.env,{RABBITMQ_HOST:n.str(),RABBITMQ_PASSWORD:n.str(),RABBITMQ_PORT:n.port({default:5672}),RABBITMQ_USER:n.str(),RABBITMQ_VHOST:n.str()}):(this.user=e.user,this.password=e.password,this.host=e.host,this.port=e.port,this.vhost=e.vhost),this.url=r.default.format("amqp://%s:%s@%s:%s/%s",this.user||process.env.RABBITMQ_USER,this.password||process.env.RABBITMQ_PASSWORD,this.host||process.env.RABBITMQ_HOST,this.port||process.env.RABBITMQ_PORT,this.vhost||process.env.RABBITMQ_VHOST),this.connect(this.url).then(function(e){t.channel=e})}var t=e.prototype;return t.canUseEnvConfig=function(e){return void 0!==e.useEnvironmentConfig},t.connect=function(e){try{return Promise.resolve(i.default.connect(e)).then(function(e){return Promise.resolve(e.createChannel())})}catch(e){return Promise.reject(e)}},t.send=function(e){try{try{console.log("[Data]",e),this.channel.assertQueue(e.queue,{durable:!0});var t=this.channel.sendToQueue(e.queue,Buffer.from(JSON.stringify(e.data)));console.log("[MQ Status]",t),console.log(" [x] Sent %s",e.data)}catch(e){console.log(e)}return Promise.resolve()}catch(e){return Promise.reject(e)}},t.onReceive=function(e){var t=e.queue;try{var n,o=this;return o.channel&&(null==(n=o.channel)||n.assertQueue(t,{durable:!0}),o.channel.consume(t,function(e){return console.log(e),console.log("[x] receiving messages"),o.channel.ack(e),new Promise(function(t){return t(e)})})),Promise.resolve(null)}catch(e){return Promise.reject(e)}},e}(),h=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}return s(t,e),t.prototype.sendEmail=function(e){var t=e.queue;this.send({data:e.data,queue:void 0===t?"email_notification":t})},t}(a),l=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}return s(t,e),t.prototype.createNotification=function(e){var t=e.queue;this.send({data:e.data,queue:void 0===t?"event_notification":t})},t}(a),f=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}return s(t,e),t}(a);return c=f,[h,l].forEach(function(e){Object.getOwnPropertyNames(e.prototype).forEach(function(t){Object.defineProperty(c.prototype,t,Object.getOwnPropertyDescriptor(e.prototype,t))})}),f});
